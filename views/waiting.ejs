<!DOCTYPE html>
<html>
    <head></head>
    <body>
        <h1>
            <h1>Searching for <span id="title"><%=parameters.title%></span></h1>
            <%let title = parameters.title%>
            <%fetch(`http://localhost:3000/scrape?title=${title}`)%>
            We are gathering results from all over the internet. Please wait 
            <span id="seconds"> 120 </span>
            seconds while we grab them for you. Please do not refresh the page.
        </h1>

        <h1>
            You will be redirected automatically.
        </h1>
    </body>



    <script>

        // const {prod} = require('../config.json')
        // const host_info = {}
        // host_info.host = prod ? "soap2daydownload.com" : "localhost";
        // host_info.port = prod ? "80" : "3000";

        let timer = setInterval(() => {
            let seconds = document.querySelector("#seconds").textContent
            document.querySelector("#seconds").textContent = seconds - 1
            if (seconds == 1) {
                clearInterval(timer)
            } 
        },1000)

        setTimeout(() => {
            
            const params = (window.location.href.split("?")[1]).split("&")
            let email;
            let title;

            params.forEach(parameter => {
                if (parameter.startsWith("email")) email = parameter.split("=")[1]
                if (parameter.startsWith("title")) title = parameter.split("=")[1]
            })

            window.location.href = `http://localhost:3000/search?title=${title}&email=${email}`

        },120000)
            

    </script>
</html>
